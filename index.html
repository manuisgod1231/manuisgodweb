<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Upload File by manyu</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
    transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
  }
  body {
    margin: 0; padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: #f0f0f5;
    color: #1c1c1e;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .panel {
    background: #fff;
    width: 320px;
    max-width: 95vw;
    padding: 28px 24px;
    border-radius: 28px;
    box-shadow:
      0 2px 5px rgba(0,0,0,0.05),
      0 15px 30px rgba(0,0,0,0.1);
    text-align: center;
    user-select: none;
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    transition: opacity 0.4s ease, transform 0.4s ease;
    margin-top: 20px;
  }
  .panel.show {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
  input, select {
    width: 100%;
    padding: 16px 18px;
    margin: 14px 0;
    border: none;
    border-radius: 20px;
    background: #f2f2f7;
    font-size: 17px;
    color: #1c1c1e;
    box-shadow:
      inset 0 1px 3px rgba(0,0,0,0.06);
    transition:
      background-color 0.25s ease,
      box-shadow 0.25s ease;
  }
  input:focus, select:focus {
    outline: none;
    background: #e5e5ea;
    box-shadow:
      inset 0 3px 6px rgba(0,0,0,0.12);
  }
  button {
    width: 100%;
    padding: 18px;
    margin-top: 18px;
    background: #007aff;
    border: none;
    border-radius: 24px;
    color: white;
    font-weight: 600;
    font-size: 18px;
    cursor: pointer;
    box-shadow:
      0 8px 15px rgba(0,122,255,0.3);
    transition:
      background-color 0.3s ease,
      box-shadow 0.3s ease,
      transform 0.15s ease;
    user-select: none;
  }
  button:hover {
    background: #005ecb;
    box-shadow:
      0 10px 20px rgba(0,94,203,0.5);
    transform: scale(1.05);
  }
  button:active {
    transform: scale(0.95);
  }
  button.deleteBtn {
    background: #ff3b30;
  }
  button.publishBtn {
    background: #34c759;
  }
  .msg {
    margin-top: 12px;
    font-style: italic;
    color: #ff3b30;
    min-height: 20px;
  }
  #moneyDisplay {
    position: fixed;
    top: 24px;
    left: 24px;
    background: #fff;
    padding: 12px 22px;
    border-radius: 26px;
    font-weight: 700;
    font-size: 18px;
    color: #007aff;
    box-shadow:
      0 8px 25px rgba(0,122,255,0.3);
    user-select: none;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
  }
  #moneyDisplay.show {
    opacity: 1;
    pointer-events: auto;
  }
  #profileToggleBtn {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: #fff;
    border-radius: 50%;
    width: 62px;
    height: 62px;
    border: none;
    font-size: 30px;
    color: #007aff;
    box-shadow:
      0 10px 28px rgba(0,122,255,0.35);
    cursor: pointer;
    transition: transform 0.25s ease, box-shadow 0.3s ease;
    user-select: none;
    opacity: 0;
    pointer-events: none;
  }
  #profileToggleBtn.show {
    opacity: 1;
    pointer-events: auto;
  }
  #profileToggleBtn:hover {
    transform: scale(1.1);
    box-shadow:
      0 14px 36px rgba(0,122,255,0.45);
  }
  #profileToggleBtn:active {
    transform: scale(0.9);
  }
  #profilePanel {
    position: fixed;
    bottom: 100px;
    right: 24px;
    width: 320px;
    max-height: 400px;
    overflow-y: auto;
    background: #fff;
    border-radius: 32px;
    box-shadow:
      0 15px 40px rgba(0,0,0,0.15);
    padding: 24px;
    text-align: left;
    font-weight: 600;
    color: #1c1c1e;
    user-select: text;
    opacity: 0;
    pointer-events: none;
    transform: translateY(20px);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }
  #profilePanel.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }
  #profilePanel button {
    width: 100%;
    margin-top: 20px;
    background: #ff3b30;
    font-weight: 700;
    border-radius: 24px;
    padding: 16px 0;
    box-shadow:
      0 8px 20px rgba(255,59,48,0.35);
    color: white;
  }
  #ownerPanel {
    position: fixed;
    bottom: 140px;
    right: 24px;
    width: 320px;
    max-height: 400px;
    overflow-y: auto;
    background: #fff;
    border-radius: 32px;
    box-shadow:
      0 15px 40px rgba(0,0,0,0.15);
    padding: 24px;
    text-align: left;
    font-weight: 600;
    color: #1c1c1e;
    user-select: text;
    opacity: 0;
    pointer-events: none;
    transform: translateY(20px);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }
  #ownerPanel.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }
  #accountList {
    max-height: 160px;
    overflow-y: auto;
    margin-top: 15px;
    padding-right: 8px;
    font-weight: 500;
    color: #444;
    border: 1px solid #eee;
    border-radius: 16px;
    background: #f9f9fb;
  }
  #ownerActions {
    margin-top: 20px;
  }
  #ownerActions input {
    width: 100%;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid #ccc;
    font-size: 16px;
    box-sizing: border-box;
    margin-top: 8px;
  }
  #ownerActions button {
    width: 100%;
    margin-top: 8px;
    background: #007aff;
    font-weight: 700;
    border-radius: 24px;
    padding: 12px 0;
    box-shadow: 0 8px 20px rgba(0,122,255,0.35);
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #ownerActions button:hover {
    background: #005ecb;
  }
  #ownerActions button.ban {
    background: #ff3b30;
  }
  #ownerActions button.ban:hover {
    background: #c62828;
  }
  #ownerMsg {
    color: #007aff;
    margin-top: 10px;
    min-height: 18px;
  }

  /* Upload Panel */
  #uploadPanel {
    margin-top: 20px;
    background: #fff;
    border-radius: 28px;
    padding: 20px;
    box-shadow:
      0 2px 5px rgba(0,0,0,0.05),
      0 15px 30px rgba(0,0,0,0.1);
    width: 320px;
    max-width: 95vw;
    user-select: none;
  }
  #uploadPanel h3 {
    margin: 0 0 12px;
  }
  #uploadPanel input[type="file"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 12px;
  }
  #uploadFilesList {
    max-height: 180px;
    overflow-y: auto;
    margin-top: 10px;
    border: 1px solid #eee;
    border-radius: 16px;
    background: #f9f9fb;
    padding: 10px;
    font-size: 14px;
  }
  #uploadFilesList div {
    margin-bottom: 8px;
    padding: 6px;
    background: #fff;
    border-radius: 12px;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    flex-direction: column;
    align-items: flex-start;
  }
  #uploadFilesList div span {
    flex-grow: 1;
    min-width: 150px;
  }
  #uploadFilesList button {
    margin-left: 8px;
    background: #007aff;
    border: none;
    border-radius: 12px;
    padding: 4px 10px;
    color: white;
    cursor: pointer;
    font-size: 13px;
  }
  #uploadFilesList button.deleteBtn {
    background: #ff3b30;
  }
  #uploadFilesList button.publishBtn {
    background: #34c759;
  }
  #uploadMsg {
    margin-top: 8px;
    color: #ff3b30;
    min-height: 20px;
  }
  /* small uploader info text */
  .uploaderInfo {
    font-size: 12px;
    color: #666;
    margin-top: 2px;
  }

  /* Scroll for profile & owner panel */
  #profilePanel, #ownerPanel {
    scrollbar-width: thin;
    scrollbar-color: #007aff #f0f0f5;
  }
  #profilePanel::-webkit-scrollbar, #ownerPanel::-webkit-scrollbar {
    width: 8px;
  }
  #profilePanel::-webkit-scrollbar-thumb, #ownerPanel::-webkit-scrollbar-thumb {
    background-color: #007aff;
    border-radius: 8px;
  }
</style>
</head>
<body>

<!-- Login Panel -->
<div id="loginPanel" class="panel show">
  <h2>Login</h2>
  <input id="loginUser" placeholder="Username" autocomplete="off" autocorrect="off" autocapitalize="none" />
  <input id="loginPass" placeholder="Password" type="password" autocomplete="off" />
  <button onclick="login()">Login</button>
  <button onclick="showCreate()">Create Account</button>
  <p id="loginMsg" class="msg"></p>
</div>

<!-- Create Account Panel -->
<div id="createPanel" class="panel">
  <h2>Create Account</h2>
  <input id="createUser" placeholder="Username" autocomplete="off" autocorrect="off" autocapitalize="none" />
  <input id="createPass" placeholder="Password" type="password" autocomplete="off" />
  <button onclick="createAccount()">Create</button>
  <button onclick="showLogin()">Back to Login</button>
  <p id="createMsg" class="msg"></p>
</div>

<!-- Money Display -->
<div id="moneyDisplay">💰 Money: $0</div>

<!-- Profile Toggle Button -->
<button id="profileToggleBtn" title="Toggle Profile">👤</button>

<!-- Profile Panel -->
<div id="profilePanel">
  <h3>Profile</h3>
  <p><strong>Username:</strong> <span id="profileUsername"></span></p>
  <p><strong>Nickname:</strong> <span id="profileNickname"></span></p>
  <p><strong>Premium:</strong> <span id="profilePremium"></span></p>
  <p><strong>Profile Logo:</strong><br /><img id="profileLogoImg" src="" alt="Logo" style="max-width:100px; border-radius:12px;" /></p>
  <h4>Settings</h4>
  <input id="nicknameInput" placeholder="Set nickname" autocomplete="off" />
  <input id="profileLogoInput" placeholder="Set profile logo URL" autocomplete="off" />
  <button onclick="saveProfileSettings()">Save Settings</button>
  <button onclick="logout()">Logout</button>
  <button id="ownerToggleBtn" style="display:none;">Toggle Owner Panel</button>
</div>

<!-- Owner Panel -->
<div id="ownerPanel">
  <h3>Owner Panel</h3>
  <h4>Accounts List:</h4>
  <div id="accountList"></div>
  <div id="ownerActions">
    <input id="targetUser" placeholder="Target username" />
    <input id="amount" placeholder="Amount" type="number" />
    <button id="giveBtn">Give Money</button>
    <button id="setBtn">Set Money</button>
    <button id="banBtn" class="ban">Ban User</button>
    <button id="unbanBtn" class="ban" style="background:#34c759; margin-top:6px;">Unban User</button>
    <button id="givePremiumBtn" style="background:#ff9f00; margin-top:6px;">Give Premium</button>
    <p id="ownerMsg"></p>
  </div>
</div>

<!-- Upload Panel -->
<div id="uploadPanel" style="display:none;">
  <h3>Upload & Publish Files</h3>
  <input type="file" id="fileInput" />
  <button onclick="uploadFile()">Upload</button>
  <div id="uploadMsg"></div>

  <h4>Your Uploaded Files:</h4>
  <div id="uploadFilesList">No files uploaded.</div>
</div>

<script>
  // -------- STORAGE AND DATA --------
  let accounts = JSON.parse(localStorage.getItem('accounts')) || {
    manyu: { password: "Manuufo25252265", money: 1000 }
  };
  let currentUser = null;

  // Add optional profile fields if missing
  for (const user in accounts) {
    if (!accounts[user].nickname) accounts[user].nickname = "";
    if (!accounts[user].profileLogo) accounts[user].profileLogo = "";
  }

  // Files by user: { username: [fileObj] }
  let userFiles = JSON.parse(localStorage.getItem('userFiles')) || {};

  // Visitor ID for unique views
  let visitorId = localStorage.getItem('visitorId');
  if (!visitorId) {
    visitorId = 'visitor-' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('visitorId', visitorId);
  }

  // Constants
  const MAX_NORMAL_FILES = 1;
  const MAX_NORMAL_FILE_SIZE = 1 * 1024 * 1024 * 1024; // 1GB
  const MAX_PREMIUM_FILES = 9999;

  // -------- ELEMENTS --------
  const loginPanel = document.getElementById('loginPanel');
  const createPanel = document.getElementById('createPanel');
  const moneyDisplay = document.getElementById('moneyDisplay');
  const profileToggleBtn = document.getElementById('profileToggleBtn');
  const profilePanel = document.getElementById('profilePanel');
  const ownerToggleBtn = document.getElementById('ownerToggleBtn');
  const ownerPanel = document.getElementById('ownerPanel');
  const accountListDiv = document.getElementById('accountList');
  const ownerMsg = document.getElementById('ownerMsg');
  const uploadPanel = document.getElementById('uploadPanel');
  const uploadFilesList = document.getElementById('uploadFilesList');
  const uploadMsg = document.getElementById('uploadMsg');
  const fileInput = document.getElementById('fileInput');

  const loginMsg = document.getElementById('loginMsg');
  const createMsg = document.getElementById('createMsg');

  // Profile settings inputs and display
  const profileUsernameSpan = document.getElementById('profileUsername');
  const profileNicknameSpan = document.getElementById('profileNickname');
  const profilePremiumSpan = document.getElementById('profilePremium');
  const profileLogoImg = document.getElementById('profileLogoImg');
  const nicknameInput = document.getElementById('nicknameInput');
  const profileLogoInput = document.getElementById('profileLogoInput');

  // Owner panel inputs
  const targetUserInput = document.getElementById('targetUser');
  const amountInput = document.getElementById('amount');
  const giveBtn = document.getElementById('giveBtn');
  const setBtn = document.getElementById('setBtn');
  const banBtn = document.getElementById('banBtn');
  const unbanBtn = document.getElementById('unbanBtn');
  const givePremiumBtn = document.getElementById('givePremiumBtn');

  // -------- UTILS --------
  function saveAccounts() {
    localStorage.setItem('accounts', JSON.stringify(accounts));
  }
  function saveUserFiles() {
    localStorage.setItem('userFiles', JSON.stringify(userFiles));
  }
  function formatMB(bytes) {
    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
  }
  function isPremium(user) {
    if (!user || !accounts[user]) return false;
    const acc = accounts[user];
    if (acc.premiumUntil === 'lifetime') return true;
    if (acc.premiumUntil && Date.now() < acc.premiumUntil) return true;
    return false;
  }
  function updateMoneyDisplay() {
    if (!currentUser) {
      moneyDisplay.classList.remove('show');
      return;
    }
    const money = accounts[currentUser]?.money || 0;
    moneyDisplay.textContent = `💰 Money: $${money}`;
    moneyDisplay.classList.add('show');
  }
  function saveCurrentUser() {
    localStorage.setItem('currentUser', currentUser);
  }
  function logout() {
    currentUser = null;
    saveCurrentUser();
    showLogin();
    updateMoneyDisplay();
    updateProfilePanel();
    uploadPanel.style.display = 'none';
    ownerToggleBtn.style.display = 'none';
    ownerPanel.classList.remove('show');
    profilePanel.classList.remove('show');
    profileToggleBtn.classList.remove('show');
  }
  function showLogin() {
    loginPanel.classList.add('show');
    createPanel.classList.remove('show');
    loginMsg.textContent = "";
    createMsg.textContent = "";
  }
  function showCreate() {
    loginPanel.classList.remove('show');
    createPanel.classList.add('show');
    loginMsg.textContent = "";
    createMsg.textContent = "";
  }
  function saveProfileSettings() {
    if (!currentUser) return;
    const nick = nicknameInput.value.trim();
    const logo = profileLogoInput.value.trim();
    accounts[currentUser].nickname = nick;
    accounts[currentUser].profileLogo = logo;
    saveAccounts();
    updateProfilePanel();
    alert("Profile settings saved!");
  }
  function updateProfilePanel() {
    if (!currentUser) return;
    profileUsernameSpan.textContent = currentUser;
    profileNicknameSpan.textContent = accounts[currentUser].nickname || "(none)";
    profilePremiumSpan.textContent = isPremium(currentUser) ? "Yes" : "No";
    if (accounts[currentUser].profileLogo) {
      profileLogoImg.src = accounts[currentUser].profileLogo;
      profileLogoImg.style.display = "block";
    } else {
      profileLogoImg.src = "";
      profileLogoImg.style.display = "none";
    }
    nicknameInput.value = accounts[currentUser].nickname || "";
    profileLogoInput.value = accounts[currentUser].profileLogo || "";
  }
  function formatDate(ts) {
    const d = new Date(ts);
    return d.toLocaleDateString() + " " + d.toLocaleTimeString();
  }

  // -------- LOGIN / CREATE --------
  function login() {
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value;
    if (!user || !pass) {
      loginMsg.textContent = "Please enter username and password.";
      return;
    }
    if (!accounts[user]) {
      loginMsg.textContent = "User does not exist.";
      return;
    }
    if (accounts[user].password !== pass) {
      loginMsg.textContent = "Incorrect password.";
      return;
    }
    if (accounts[user].banned) {
      loginMsg.textContent = "You are banned.";
      return;
    }
    currentUser = user;
    saveCurrentUser();
    loginMsg.textContent = "";
    loginPanel.classList.remove('show');
    createPanel.classList.remove('show');
    profileToggleBtn.classList.add('show');
    uploadPanel.style.display = 'block';
    ownerToggleBtn.style.display = (currentUser === 'manyu') ? 'block' : 'none';
    updateMoneyDisplay();
    updateProfilePanel();
    refreshUploadFileList();
  }
  function createAccount() {
    const user = document.getElementById('createUser').value.trim();
    const pass = document.getElementById('createPass').value;
    if (!user || !pass) {
      createMsg.textContent = "Please enter username and password.";
      return;
    }
    if (accounts[user]) {
      createMsg.textContent = "User already exists.";
      return;
    }
    accounts[user] = { password: pass, money: 0, nickname: "", profileLogo: "" };
    saveAccounts();
    createMsg.textContent = "Account created! Please login.";
  }

  // -------- OWNER PANEL --------
  function refreshAccountList() {
    accountListDiv.innerHTML = "";
    for (const u in accounts) {
      let info = `${u} - Money: $${accounts[u].money || 0}`;
      if (accounts[u].banned) info += " [BANNED]";
      if (isPremium(u)) info += " [PREMIUM]";
      if (accounts[u].nickname) info += ` [Nick: ${accounts[u].nickname}]`;
      if (accounts[u].profileLogo) info += ` [Logo Set]`;
      const div = document.createElement('div');
      div.textContent = info;
      accountListDiv.appendChild(div);
    }
  }

  giveBtn.onclick = () => {
    const target = targetUserInput.value.trim();
    const amount = Number(amountInput.value);
    if (!accounts[target]) { ownerMsg.textContent = "User not found."; return; }
    if (isNaN(amount) || amount <= 0) { ownerMsg.textContent = "Invalid amount."; return; }
    accounts[target].money = (accounts[target].money || 0) + amount;
    saveAccounts();
    ownerMsg.textContent = `Gave $${amount} to ${target}.`;
    updateMoneyDisplay();
    refreshAccountList();
  };
  setBtn.onclick = () => {
    const target = targetUserInput.value.trim();
    const amount = Number(amountInput.value);
    if (!accounts[target]) { ownerMsg.textContent = "User not found."; return; }
    if (isNaN(amount) || amount < 0) { ownerMsg.textContent = "Invalid amount."; return; }
    accounts[target].money = amount;
    saveAccounts();
    ownerMsg.textContent = `Set $${amount} for ${target}.`;
    updateMoneyDisplay();
    refreshAccountList();
  };
  banBtn.onclick = () => {
    const target = targetUserInput.value.trim();
    if (!accounts[target]) { ownerMsg.textContent = "User not found."; return; }
    accounts[target].banned = true;
    saveAccounts();
    ownerMsg.textContent = `Banned ${target}.`;
    refreshAccountList();
  };
  unbanBtn.onclick = () => {
    const target = targetUserInput.value.trim();
    if (!accounts[target]) { ownerMsg.textContent = "User not found."; return; }
    accounts[target].banned = false;
    saveAccounts();
    ownerMsg.textContent = `Unbanned ${target}.`;
    refreshAccountList();
  };
  givePremiumBtn.onclick = () => {
    const target = targetUserInput.value.trim();
    if (!accounts[target]) { ownerMsg.textContent = "User not found."; return; }
    // Give 30 days premium from now or lifetime for demo you can set your own
    accounts[target].premiumUntil = Date.now() + 30*24*60*60*1000; // 30 days
    saveAccounts();
    ownerMsg.textContent = `Gave 30 days premium to ${target}.`;
    refreshAccountList();
    if (target === currentUser) updateProfilePanel();
  };

  // -------- PROFILE PANEL --------
  profileToggleBtn.onclick = () => {
    if (profilePanel.classList.contains('show')) {
      profilePanel.classList.remove('show');
      ownerPanel.classList.remove('show');
    } else {
      profilePanel.classList.add('show');
      if (currentUser !== 'manyu') ownerPanel.classList.remove('show');
    }
  };

  ownerToggleBtn.onclick = () => {
    if (ownerPanel.classList.contains('show')) {
      ownerPanel.classList.remove('show');
    } else {
      ownerPanel.classList.add('show');
    }
  };

  // -------- UPLOAD PANEL --------

  function setUploadMsg(msg) {
    uploadMsg.textContent = msg;
  }
  function clearUploadMsg() {
    uploadMsg.textContent = "";
  }

  function uploadFile() {
    clearUploadMsg();
    if (!currentUser) {
      setUploadMsg('⚠️ Please login to upload files.');
      return;
    }
    if (!fileInput.files.length) {
      setUploadMsg('⚠️ Please select a file.');
      return;
    }
    const file = fileInput.files[0];
    const files = userFiles[currentUser] || [];
    const premium = isPremium(currentUser);

    if (!premium && files.length >= MAX_NORMAL_FILES) {
      setUploadMsg(`⚠️ Normal users can upload max ${MAX_NORMAL_FILES} file(s).`);
      return;
    }
    if (!premium && file.size > MAX_NORMAL_FILE_SIZE) {
      setUploadMsg('⚠️ Max file size for normal users is 1 GB.');
      return;
    }
    if (premium && files.length >= MAX_PREMIUM_FILES) {
      setUploadMsg('⚠️ You have reached your max upload files limit.');
      return;
    }

    const now = Date.now();
    const expiry = premium ? null : now + 30*24*60*60*1000; // 30 days expiry normal users

    const newFile = {
      name: file.name,
      size: file.size,
      uploadDate: now,
      expiryDate: expiry,
      published: false,
      viewers: [],
      uploader: currentUser
    };

    files.push(newFile);
    userFiles[currentUser] = files;
    saveUserFiles();
    fileInput.value = "";
    setUploadMsg(`Uploaded "${file.name}" successfully.`);
    refreshUploadFileList();
  }

  function refreshUploadFileList() {
    const files = userFiles[currentUser] || [];
    if (files.length === 0) {
      uploadFilesList.innerHTML = "No files uploaded.";
      return;
    }
    uploadFilesList.innerHTML = "";
    files.forEach((file, index) => {
      const div = document.createElement("div");

      const nameSpan = document.createElement("span");
      nameSpan.textContent = `${file.name} (${formatMB(file.size)})${file.published ? " [Published]" : ""} - Views: ${file.viewers.length}`;
      div.appendChild(nameSpan);

      const uploaderMsg = document.createElement("div");
      uploaderMsg.className = "uploaderInfo";
      uploaderMsg.textContent = `Uploaded by: ${file.uploader}`;
      div.appendChild(uploaderMsg);

      const downloadBtn = document.createElement("button");
      downloadBtn.textContent = "Download";
      downloadBtn.onclick = () => {
        alert(`Pretend downloading: ${file.name}`);
        if (file.published) {
          if (!file.viewers.includes(visitorId)) {
            file.viewers.push(visitorId);
            saveUserFiles();
            refreshUploadFileList();
          }
        }
      };
      div.appendChild(downloadBtn);

      const publishBtn = document.createElement("button");
      publishBtn.textContent = file.published ? "Unpublish" : "Publish";
      publishBtn.className = "publishBtn";
      publishBtn.onclick = () => {
        file.published = !file.published;
        if (!file.published) file.viewers = [];
        saveUserFiles();
        refreshUploadFileList();
      };
      div.appendChild(publishBtn);

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.className = "deleteBtn";
      deleteBtn.onclick = () => {
        if (confirm(`Delete file "${file.name}"?`)) {
          files.splice(index, 1);
          userFiles[currentUser] = files;
          saveUserFiles();
          refreshUploadFileList();
        }
      };
      div.appendChild(deleteBtn);

      uploadFilesList.appendChild(div);
    });
  }

  // -------- ONLOAD --------
  window.onload = () => {
    currentUser = localStorage.getItem("currentUser");
    if (currentUser && accounts[currentUser] && !accounts[currentUser].banned) {
      loginPanel.classList.remove('show');
      createPanel.classList.remove('show');
      profileToggleBtn.classList.add('show');
      uploadPanel.style.display = 'block';
      ownerToggleBtn.style.display = (currentUser === 'manyu') ? 'block' : 'none';
      updateMoneyDisplay();
      updateProfilePanel();
      refreshUploadFileList();
    } else {
      currentUser = null;
      showLogin();
      updateMoneyDisplay();
      uploadPanel.style.display = 'none';
      ownerToggleBtn.style.display = 'none';
      profileToggleBtn.classList.remove('show');
    }
    refreshAccountList();
  };
</script>
</body>
</html>
